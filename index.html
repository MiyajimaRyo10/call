<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>擬似LINE電話</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Hiragino Kaku Gothic ProN", sans-serif; overflow: hidden; -webkit-user-select: none; user-select: none; }
        .screen { width: 100%; height: 100vh; display: flex; flex-direction: column; justify-content: space-between; align-items: center; color: white; box-sizing: border-box; padding: 20px; }
        #incoming-call-screen { background: linear-gradient(160deg, #756B92, #4A446B); }
        .caller-info {
            text-align: center;
            margin-top: 100px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* ✨ 上揃えに変更 */
        }
        .caller-info .account-type { font-size: 16px; opacity: 0.8; }
        .caller-info h1 { font-size: 28px; font-weight: 600; margin-top: 8px; }
        .actions { width: 100%; display: flex; justify-content: space-around; padding-bottom: 50px; }
        .action-button { text-align: center; cursor: pointer; }
        .btn-circle { width: 70px; height: 70px; border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-bottom: 10px; }
        .btn-circle.reject { background-color: #F85A5B; }
        .btn-circle.answer { background-color: #38C356; }
        .action-button span { font-size: 14px; }
        #active-call-screen { background-color: #4A5C6A; }
        .profile-area { display: flex; flex-direction: column; align-items: center; justify-content: center; flex-grow: 1; }
        .profile-pic { width: 140px; height: 140px; border-radius: 50%; overflow: hidden; border: 3px solid rgba(255, 255, 255, 0.1); }
        .profile-pic img { width: 100%; height: 100%; object-fit: cover; }
        .profile-name { font-size: 24px; font-weight: 500; margin-top: 20px; }
        .call-status-dots { margin-top: 10px; }
        .call-status-dots span { display: inline-block; width: 6px; height: 6px; background-color: #38C356; border-radius: 50%; margin: 0 3px; opacity: 0.6; }
        .controls { width: 100%; display: flex; justify-content: space-around; align-items: center; padding-bottom: 50px; }
        .control-button { display: flex; flex-direction: column; align-items: center; color: white; cursor: pointer; }
        .control-button span { font-size: 12px; margin-top: 8px; }
        .btn-circle.end { width: 65px; height: 65px; background-color: #F85A5B; }
        #call-ended-screen { background-color: #2c3e50; justify-content: center; }
        .end-message h1 { font-weight: 500; }
    </style>
</head>
<body>

    <div id="incoming-call-screen" class="screen">
        <div class="caller-info">
            <p class="account-type">LINE オーディオ...</p>
            <h1>橘 涼介</h1>
        </div>
        <div class="actions">
            <div class="action-button" id="reject-button">
                <div class="btn-circle reject"><svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div>
                <span>拒否</span>
            </div>
            <div class="action-button" id="answer-button">
                <div class="btn-circle answer"><svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"></path></svg></div>
                <span>応答</span>
            </div>
        </div>
    </div>

    <div id="active-call-screen" class="screen" style="display: none;">
        <div class="profile-area">
            <div class="profile-pic"><img src="profile.jpg" alt="プロフィール画像"></div>
            <h2 class="profile-name">橘 涼介</h2>
            <div class="call-status-dots"><span></span><span></span><span></span><span></span></div>
        </div>
        <div class="controls">
            <div class="control-button"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line></svg><span>マイクをオフ</span></div>
            <div class="control-button" id="end-call-button"><div class="btn-circle end"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div>
            <div class="control-button"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg><span>スピーカーをオン</span></div>
        </div>
    </div>

    <div id="call-ended-screen" class="screen" style="display: none;">
        <div class="end-message">
            <h1>通話が終了しました</h1>
        </div>
    </div>

    <audio id="ringtone-audio" src="ringtone.mp3" loop preload="auto"></audio>
    <audio id="call-audio" src="call_audio.mp3" preload="auto"></audio>

    <script>
        // JavaScriptコードは変更ありません
        const incomingCallScreen = document.getElementById('incoming-call-screen');
        const activeCallScreen = document.getElementById('active-call-screen');
        const callEndedScreen = document.getElementById('call-ended-screen');
        const answerButton = document.getElementById('answer-button');
        const rejectButton = document.getElementById('reject-button');
        const endCallButton = document.getElementById('end-call-button');
        const ringtoneAudio = document.getElementById('ringtone-audio');
        const callAudio = document.getElementById('call-audio');

        window.addEventListener('load', () => {
            ringtoneAudio.volume = 0.5;
            ringtoneAudio.play().catch(error => {
                console.log("着信音の自動再生がブロックされました。");
                document.body.addEventListener('click', () => ringtoneAudio.play(), { once: true });
            });
        });
        
        const handleCallEnd = () => {
            ringtoneAudio.pause();
            callAudio.pause();
            activeCallScreen.style.display = 'none';
            window.close();
            setTimeout(() => {
                console.log("タブを閉じられませんでした。代わりに終了画面を表示します。");
                callEndedScreen.style.display = 'flex';
            }, 500);
        };

        answerButton.addEventListener('click', () => {
            ringtoneAudio.pause();
            ringtoneAudio.currentTime = 0;
            incomingCallScreen.style.display = 'none';
            activeCallScreen.style.display = 'flex';
            callAudio.play();
        });

        rejectButton.addEventListener('click', () => {
            window.close();
        });

        endCallButton.addEventListener('click', () => {
            handleCallEnd();
        });

        callAudio.addEventListener('ended', () => {
            console.log("通話音声が終了しました。");
            handleCallEnd();
        });
    </script>
</body>
</html>
